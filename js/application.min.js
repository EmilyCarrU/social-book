// Main Entry point into app.
window.App={};App.Decade=Backbone.Model.extend({title:"",decade:null,initialize:function(e){this.set("decade",parseInt(e.slug))}});App.Chapter=Backbone.Model.extend({slug:"",title:"",content:"",comment_status:!1,decade:null,initialize:function(e){var t=e.slug.match(/(\d{4})-(\d{2})-(\d{2})/);if(t){this.set("decade",parseInt(t[1]));this.set("year",parseInt(t[2]));this.set("part",parseInt(t[3]))}this.comments=new App.Comments(e.comments)}});App.Comment=Backbone.Model.extend({});App.Decades=Backbone.Collection.extend({model:App.Decade,url:"http://book.hyko.org/api/get_tag_posts/?tag=decade",initialize:function(){},comparator:function(e){return e.get("decade")},parse:function(e){return e.posts}});App.Chapters=Backbone.Collection.extend({model:App.Chapter,comparator:function(e,t){if(e.decade<t.decade)return 1;if(e.decade>t.decade)return-1;if(e.decade===t.decade){if(e.month<t.month)return 1;if(e.year>t.year)return-1;if(e.year===t.year){if(e.part<t.part)return 1;if(e.part>t.part)return-1;if(e.part===t.part)return 0}}},parse:function(e){return e.posts}});App.Comments=Backbone.Collection.extend({model:App.Comment});App.CommentView=Backbone.View.extend({events:{"tap .com_comments_comment_reply":"addComment","click .com_comments_comment_reply":"addComment"},addComment:function(e){e.preventDefault();e.stopPropagation();alert("Add Comment")},render:function(){var e=_.template($("#template-comment").html()),t=e(this.model.toJSON());$(this.el).append(t);return this}});App.CommentsView=Backbone.View.extend({events:{"click .target__com":"toggleComments","tap .target__com":"toggleComments"},toggleComments:function(e){e.preventDefault();e.stopPropagation();$(this.el).find(".com").toggleClass("com__open")},render:function(){var e=_.template($("#template-comments").html()),t=e(this.model.toJSON());$(this.el).append(t);this.collection.each(function(e){var t=new App.CommentView({model:e});$(this.el).find(".com_comments").append(t.render().el)},this);return this}});App.SectionView=Backbone.View.extend({render:function(){var e=_.template($("#template-section").html()),t=e(this.model.toJSON());$(this.el).append(t);if(this.model.get("comment_status")==="open"){var n=new App.CommentsView({collection:this.model.comments,model:this.model});$(this.el).append(n.render().el)}return this}});App.DecadeView=Backbone.View.extend({tagName:"li",events:{"click li":"expandItem"},expandItem:function(){$(this.el).find(".chap").toggleClass("chap__open")},initialize:function(e){var t=this;this.chapters=new App.Chapters(chapters);var n=function(e){return e.attributes.decade==t.model.get("decade")?!0:!1},r=t.chapters.filter(n);this.chapters.reset(r)},render:function(){this.chaptersView=new App.ChaptersView({collection:this.chapters});var e=_.template($("#template-decade").html()),t=e(this.model.toJSON());$(this.el).append(t);$(this.el).find(".chapters").html(this.chaptersView.render().el);return this}});App.DecadesView=Backbone.View.extend({tagName:"ul",className:"decade",render:function(){this.collection.each(function(e){var t=new App.DecadeView({model:e});$(this.el).append(t.render().el)},this);return this}});App.ChaptersView=Backbone.View.extend({tagName:"article",className:"chap",render:function(){console.log(this.collection);this.collection.each(function(e){var t=new App.SectionView({model:e});$(this.el).prepend(t.render().el)},this);return this}});App.Router=Backbone.Router.extend({routes:{"*path":"defaultRoute"},defaultRoute:function(e){App.decades=new App.Decades(decadeData);App.decadesView=new App.DecadesView({collection:App.decades});$("#decades").html(App.decadesView.render().el)}});$(function(){Backbone.emulateJSON=!0;App.router=new App.Router;Backbone.history.start()});